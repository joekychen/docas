<!DOCTYPE html>
<html><head><title>baoshan/docas » src › server › doccx.rb
| Folder Index Generator
</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />
<link rel="stylesheet" type="text/css" media="all" href="common.css" />

</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><h1>doccx.rb</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>Folder Index Generator</p></td><td class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;set&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;grit&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;optparse&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;fileutils&#39;</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><h2>Parsing Arguments</h2>

<p>Following arguments are mandatory:</p>

<ul>
<li><code>working</code>: specify <strong>working</strong> directory.</li>
<li><code>sources</code>: specify <strong>sources</strong> directory.</li>
</ul></td><td class="code"><div class="highlight"><pre><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">option_parser</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s2">&quot;--working DIR&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:working</span><span class="o">]</span> <span class="o">=</span> <span class="n">dir</span> <span class="p">}</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s2">&quot;--sources DIR&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:sources</span><span class="o">]</span> <span class="o">=</span> <span class="n">dir</span> <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="n">parse!</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><h2>Get Touched Directories Recursively</h2>

<p>Touched directories are directories of all touched and deleted files, and
their ancestor directories, up to the root directory of the repository.</p></td><td class="code"><div class="highlight"><pre><span class="n">directories</span> <span class="o">=</span> <span class="no">Set</span><span class="o">.</span><span class="n">new</span>
<span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">options</span><span class="o">[</span><span class="ss">:working</span><span class="o">]</span><span class="si">}</span><span class="s2">/.touched&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each_line</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="n">directories</span><span class="o">.</span><span class="n">add</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span> <span class="n">file</span> <span class="p">}</span>
<span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">options</span><span class="o">[</span><span class="ss">:working</span><span class="o">]</span><span class="si">}</span><span class="s2">/.deleted&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each_line</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="n">directories</span><span class="o">.</span><span class="n">add</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span> <span class="n">file</span> <span class="p">}</span>
<span class="n">tmp_set_0</span> <span class="o">=</span> <span class="n">directories</span>
<span class="k">while</span> <span class="n">tmp_set_0</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="o">!</span><span class="n">tmp_set_0</span><span class="o">.</span><span class="n">include?</span> <span class="s1">&#39;.&#39;</span>
  <span class="n">tmp_set_1</span> <span class="o">=</span> <span class="no">Set</span><span class="o">.</span><span class="n">new</span>
  <span class="n">tmp_set_0</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">directory</span><span class="o">|</span> <span class="n">tmp_set_1</span><span class="o">.</span><span class="n">add</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span> <span class="n">directory</span> <span class="p">}</span>
  <span class="n">directories</span> <span class="o">|=</span> <span class="n">tmp_set_0</span> <span class="o">=</span> <span class="n">tmp_set_1</span>
<span class="k">end</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><h2>Human Readable File Size</h2>

<p>Borrowed from <a href="http://d.hatena.ne.jp/Constellation/20090424/1240570837">枕を欹てて聴く</a>'s blog.</p></td><td class="code"><div class="highlight"><pre><span class="vi">@bytes</span> <span class="o">=</span> <span class="sx">%w(B K M G T P E Z Y)</span>
<span class="k">def</span> <span class="nf">humanize_number</span> <span class="n">size</span>
  <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="kp">loop</span> <span class="k">do</span>
    <span class="k">break</span> <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="o">&amp;&amp;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">8</span>
    <span class="n">size</span> <span class="o">/=</span> <span class="mi">1024</span><span class="o">.</span><span class="mi">0</span>
    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
  <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">10</span>
    <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;%.1f%s&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="vi">@bytes</span><span class="o">[</span><span class="n">cnt</span><span class="o">]</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;%i%s&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="vi">@bytes</span><span class="o">[</span><span class="n">cnt</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><h2>Get Document Name</h2>

<p>Document name will be the same file name with extention <code>.html</code>, examples:</p>

<ul>
<li><code>awe_some_source.rb</code> -> <code>aws_some_source.html</code></li>
<li><code>.hidden_source</code> -> <code>hidden_source.html</code></li>
</ul></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_document_name</span> <span class="n">source_name</span>
  <span class="n">segments</span> <span class="o">=</span> <span class="n">source_name</span><span class="o">.</span><span class="n">split</span> <span class="s1">&#39;.&#39;</span>
  <span class="k">while</span> <span class="n">segments</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
    <span class="n">segments</span><span class="o">.</span><span class="n">shift</span>
  <span class="k">end</span>
  <span class="n">segments</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">segments</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
<span class="k">end</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><h2>Generate docas.idx For Touched Directories</h2>

<p>Find all repositories</p>

<p>Grit is used to get latest commit message for each file. Grit use
<code>posix_spawn</code> and <code>git</code> command to get commit logs internally.</p>

<p>In order to accelerate processing, multi-threading is used to make Grit's
<code>log</code> faster. The maximum parallel threads is set to 4.</p>

<p>Generated <code>docas.idx</code> will be of the following format:</p>

<ul>
<li>type</li>
<li>name</li>
<li>action</li>
<li>size</li>
<li>sloc</li>
<li>author</li>
<li>email</li>
<li>date</li>
<li>description</li>
<li>message</li>
</ul>

<p>Fields are seperated by <code>|</code> (vertical bar with left and right spaces). Each
line represents a single entry.</p></td><td class="code"><div class="highlight"><pre><span class="n">repo</span> <span class="o">=</span> <span class="no">Grit</span><span class="o">::</span><span class="no">Repo</span><span class="o">.</span><span class="n">new</span> <span class="n">options</span><span class="o">[</span><span class="ss">:sources</span><span class="o">]</span>
<span class="n">submodules</span> <span class="o">=</span> <span class="no">Grit</span><span class="o">::</span><span class="no">Submodule</span><span class="o">.</span><span class="n">config</span> <span class="n">repo</span>

<span class="n">directories</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">directory</span><span class="o">|</span>
  <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span> <span class="n">target_directory</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">options</span><span class="o">[</span><span class="ss">:working</span><span class="o">]</span><span class="si">}</span><span class="s2">/ghpages/</span><span class="si">#{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="no">File</span><span class="o">.</span><span class="n">open</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">target_directory</span><span class="si">}</span><span class="s2">/docas.idx&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">glob</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">threads</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:join</span><span class="p">)</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">clear</span>
      <span class="k">end</span>
      <span class="n">threads</span><span class="o">.</span><span class="n">push</span> <span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span>
        <span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span> <span class="n">glob</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">stat</span><span class="o">.</span><span class="n">directory?</span> <span class="p">?</span> <span class="s1">&#39;d&#39;</span> <span class="p">:</span> <span class="s1">&#39;f&#39;</span>
	<span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span> <span class="o">+</span> <span class="n">submodules</span><span class="o">[</span><span class="n">glob</span><span class="o">][</span><span class="s2">&quot;url&quot;</span><span class="o">].</span><span class="n">match</span><span class="p">(</span><span class="sr">/(?:git@|git:\/\/|http:\/\/)github\.com(?::|\/)([^\.]*)(\.git)?/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">submodules</span><span class="o">.</span><span class="n">include?</span> <span class="n">glob</span><span class="p">)</span>
        <span class="nb">name</span> <span class="o">=</span> <span class="n">glob</span><span class="o">[</span><span class="n">directory</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">glob</span><span class="o">.</span><span class="n">size</span><span class="o">]</span>
        <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">size</span>
        <span class="n">sloc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;master&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="p">,</span> <span class="ss">:max_count</span> <span class="o">=&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">gsub</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;||&#39;</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">gsub</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;||&#39;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span> <span class="s1">&#39;%s&#39;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;||&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Folder specific fields.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span>
          <span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">glob</span><span class="p">)</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">2</span><span class="si">}</span><span class="s2"> items&quot;</span>
          <span class="n">readme_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">glob</span><span class="si">}</span><span class="s2">/README.md&quot;</span>
          <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span> <span class="n">readme_path</span>
            <span class="k">begin</span>
              <span class="n">readme</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span> <span class="n">readme_path</span>
              <span class="n">description_line</span> <span class="o">=</span> <span class="n">readme</span><span class="o">.</span><span class="n">readline</span>
              <span class="k">if</span> <span class="n">readme</span><span class="o">.</span><span class="n">eof?</span> <span class="ow">or</span> <span class="n">readme</span><span class="o">.</span><span class="n">readline</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="n">description</span> <span class="o">=</span> <span class="n">description_line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/\s{4}(.*)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
              <span class="k">end</span>
            <span class="k">rescue</span>
            <span class="k">end</span>
          <span class="k">end</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Populating file specified fields.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">else</span>

          <span class="n">size</span> <span class="o">=</span> <span class="n">humanize_number</span> <span class="n">size</span>
          <span class="n">document</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">options</span><span class="o">[</span><span class="ss">:working</span><span class="o">]</span><span class="si">}</span><span class="s2">/ghpages/</span><span class="si">#{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">get_document_name</span> <span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">exists?</span> <span class="n">document</span><span class="p">)</span>
            <span class="n">sloc</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">file</span><span class="o">.</span><span class="n">each_line</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="n">sloc</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">unless</span> <span class="sr">/\S/</span> <span class="o">!~</span> <span class="n">line</span><span class="o">.</span><span class="n">encode!</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="ss">:invalid</span> <span class="o">=&gt;</span> <span class="ss">:replace</span><span class="p">)</span> <span class="p">}</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
          <span class="k">else</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
          <span class="k">end</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Recognize description for the source file.</p></td><td class="code"><div class="highlight"><pre>          <span class="k">begin</span>
            <span class="n">source</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span> <span class="n">glob</span>
            <span class="n">description_line</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">readline</span>
            <span class="k">if</span> <span class="n">description_line</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;#!&#39;</span>
              <span class="n">source</span><span class="o">.</span><span class="n">readline</span>
              <span class="n">description_line</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">readline</span> 
            <span class="k">end</span>
            <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">eof?</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">readline</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">1</span>
              <span class="n">description</span> <span class="o">=</span> <span class="n">description_line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^\S{0,3}\s{4}(.+)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">rescue</span>
          <span class="k">end</span>

        <span class="k">end</span>

        <span class="n">f</span> <span class="o">&lt;&lt;</span> <span class="o">[</span>
          <span class="n">type</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
          <span class="nb">name</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
          <span class="n">action</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
          <span class="n">size</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
          <span class="n">sloc</span><span class="p">,</span>
          <span class="n">author</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
          <span class="n">email</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
          <span class="n">date</span><span class="p">,</span>
          <span class="n">description</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
          <span class="n">message</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; | &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

      <span class="p">}</span>
    <span class="k">end</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:join</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

</pre></div></td></tr>

</tbody>
</table>
</div>
<script src="../../docas/all_src/server/doccx.rb_.js" type="text/javascript"></script>
</body>
<script>docas={repo:"baoshan/docas",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
